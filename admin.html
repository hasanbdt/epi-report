<!-- тЬЕ Filter + Final Report Enabled Version -->
<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>рж░рж┐ржкрзЛрж░рзНржЯ рждрж╛рж▓рж┐ржХрж╛</title>
  <style>
    body {
      font-family: "Siyam Rupali", sans-serif;
      background: #fffdee;
      padding: 20px;
      max-width: 98%;
      margin: auto;
    }
    h2, h3 {
      text-align: center;
      color: #333;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 6px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background-color: #007f5f;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f7f7f7;
    }
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .edit-btn { background-color: #f0ad4e; color: white; }
    .delete-btn { background-color: #d9534f; color: white; }
    .filter-area {
      margin: 20px 0;
      text-align: center;
    }
    .filter-area input, .filter-area select {
      padding: 5px 10px;
      margin: 0 5px;
      font-size: 14px;
    }
	
	@media print {
      #finalActions, button {
        display: none !important;
      }
      th {
        background-color: #007f5f !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
	
	.institute-header {
	  text-align: center;
	  margin-bottom: 10px;
	  margin-top: 10px;
	  font-family: 'Siyam Rupali', sans-serif;
	}

	.institute-header .logo {
	  width: 100px;
	  height: auto;
	  vertical-align: middle;
	  margin-bottom: 0px;
	}

	.institute-header h1 {
	  color: #007f5f;
	  margin: 5px 0 2px 0; /* ржЙржкрж░рзЗ ржирж┐ржЪрзЗ ржлрж╛ржБржХрж╛ ржХржо */
	  font-size: 24px;
	}

	.institute-header h3 {
	  color: #555;
	  margin: 2px 0 10px 0;
	  font-size: 16px;
	  font-weight: normal;
	}
</style>
</head>
<body> 

<!-- ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╢рзБрж░рзБ -->
<div id="passwordPrompt" style="text-align:center; margin-top:100px;">
  <h2>ЁЯФР ржПржЗ ржкрзЗржЗржЬ ржжрзЗржЦрждрзЗ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржжрж┐ржи:</h2>
  <input type="password" id="pagePassword" placeholder="ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржжрж┐ржи" style="padding:10px; font-size:16px;"/>
  <br><br>
  <button onclick="verifyPassword()" style="padding:8px 20px; font-size:16px;">рж╕рж╛ржмржорж┐ржЯ</button>
  <p id="errorText" style="color:red; margin-top:10px;"></p>
</div>

<div id="mainContent" style="display:none;">
  <!-- ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╢рзЗрж╖ -->

<!-- Base URL for relative links -->
<base href="https://hasanbdt.github.io/epi-report/">

<!-- тЬЕ Navigation Menu Start -->
<style>
  .nav-links {
    background-color: #007f5f;
    padding: 10px 0;
    text-align: center;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .nav-links a {
    color: white;
    text-decoration: none;
    margin: 0 15px;
    font-size: 16px;
    font-weight: bold;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background-color 0.3s ease;
  }

  .nav-links a:hover {
    background-color: #34a0a4;
  }
</style>

<div class="nav-links">
  <a href="https://hasanbdt.github.io/epi-report/index.html">ЁЯУе рж░рж┐ржкрзЛрж░рзНржЯ ржЬржорж╛</a>
  <a href="https://hasanbdt.github.io/epi-report/list.html">ЁЯУЛ рж░рж┐ржкрзЛрж░рзНржЯ рж╕ржорзНржорж┐рж▓рж┐ржд</a>
  <a href="https://hasanbdt.github.io/epi-report/list-final.html">тнР рж░рж┐ржкрзЛрж░рзНржЯ ржЪрзВрзЬрж╛ржирзНржд</a>
  <a href="https://hasanbdt.github.io/epi-report/edit.html">тнР рж╕ржорзНржкрж╛ржжржирж╛</a>
  <a href="https://hasanbdt.github.io/epi-report/admin.html">тнР ржПрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓</a>
</div> 
<!-- тЬЕ Navigation Menu End -->

<div class="institute-header">
  <img src="epi.png" alt="Logo" class="logo" />
  <h1>ржЗржкрж┐ржЖржЗ ржПржХрж╛ржбрзЗржорж┐, ржврж╛ржХрж╛</h1>
  <h3>рж╕рзНржмржкрзНржи ржкрзВрж░ржгрзЗ ржЖржЧрж╛ржорзАрж░ ржкржерзЗ...</h3>
</div>

  <h2>ЁЯУЛ рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзАржжрзЗрж░ рж░рж┐ржкрзЛрж░рзНржЯ рждрж╛рж▓рж┐ржХрж╛</h2>
  
  <div class="filter-area">
    <input type="date" id="dateFilter">
    <input type="text" id="nameFilter" placeholder="ржирж╛ржо">
    <select id="classFilter">
      <option value="">рж╢рзНрж░рзЗржгрж┐ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи</option>
      <option value="One">One</option>
      <option value="Two">Two</option>
	  <option value="Three">Three</option>
	  <option value="Four">Four</option>
	  <option value="Five">Five</option>
	  <option value="Six">Six</option>
	  <option value="Seven">Seven</option>
	  <option value="Eight">Eight</option>
	  <option value="Nine">Nine</option>
	  <option value="Ten">Ten</option>
    </select>
    <button onclick="refreshList()">ЁЯФН ржлрж┐рж▓рзНржЯрж╛рж░ ржХрж░рзБржи</button>
    <button onclick="clearFilters()">ЁЯФД рж╕ржм ржжрзЗржЦрж╛ржи</button>
    <button onclick="generateFinalReport()">ЁЯУК ржЪрзВрзЬрж╛ржирзНржд ржлрж▓рж╛ржлрж▓</button>
  </div>

  <table id="reportTable">
    <thead>
      <tr>
        <th>рждрж╛рж░рж┐ржЦ</th>
        <th>ржирж╛ржо</th>
        <th>ржХрзНрж▓рж╛рж╕</th>
        <th>рж░рзЛрж▓</th>
        <th>рж╕рзНржЯрж╛рж░ ЁЯМЯ</th>
        <th>ржжрж┐ржи</th>
        <th>рж╢рзЗржЦрж╛</th>
        <th>ржнрж╛рж▓рзЛ ржХрж╛ржЬ</th>
        <th>ржнрзБрж▓</th>
        <th>ржнрж╛рж▓рзЛржмрж╛рж╕рж╛</th>
        <th>ржнрж╛ржмржирж╛</th>
        <th>ржирж╛ржорж╛ржЬ</th>
        <th>P H M</th>
        <th>тЬПя╕П</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="finalReport" style="margin-top:30px; display:none;"> 

	<style>
	.institute-header {
	  text-align: center;
	  margin-bottom: 10px;
	  margin-top: 10px;
	  font-family: 'Siyam Rupali', sans-serif;
	}

	.institute-header .logo {
	  width: 100px;
	  height: auto;
	  vertical-align: middle;
	  margin-bottom: 0px;
	}

	.institute-header h1 {
	  color: #007f5f;
	  margin: 5px 0 2px 0; /* ржЙржкрж░рзЗ ржирж┐ржЪрзЗ ржлрж╛ржБржХрж╛ ржХржо */
	  font-size: 24px;
	}

	.institute-header h3 {
	  color: #555;
	  margin: 2px 0 10px 0;
	  font-size: 16px;
	  font-weight: normal;
	}
	</style> 
  
	<div class="institute-header">
	  <img src="epi.png" alt="Logo" class="logo" />
	  <h1>ржЗржкрж┐ржЖржЗ ржПржХрж╛ржбрзЗржорж┐, ржврж╛ржХрж╛</h1>
	  <h3>рж╕рзНржмржкрзНржи ржкрзВрж░ржгрзЗ ржЖржЧрж╛ржорзАрж░ ржкржерзЗ...</h3>
    </div>
	<h3 style="text-align:center; color:#007f5f; font-size: 30px; margin-bottom: 10px;">ЁЯУЛ рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзАржжрзЗрж░ ржЪрзВрзЬрж╛ржирзНржд ржлрж▓рж╛ржлрж▓ </h3>

    <table id="finalTable">
      <thead>
        <tr>
          <th>ржирж╛ржо</th>
          <th>ржХрзНрж▓рж╛рж╕</th>
          <th>рж░рзЛрж▓</th>
          <th>ржорзЛржЯ рж╕рзНржХрзЛрж░</th>
          <th>рж╕рзНржЯрж╛рж░</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
	
	<p style= "font-size:15px; color: red; text-align: center;"> рж╕рзМржнрж╛ржЧрзНржп рждрж╛рж░; ржпрж╛рж░ ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐ ржЧрждржХрж╛рж▓рзЗрж░ ржЪрзЗрзЯрзЗ ржЙрждрзНрждржо рж╣рзЯрзЗржЫрзЗред</p>
	
     <div id="finalActions" style="text-align:center; margin-top:20px">
     <button onclick="printFinalReport()">ЁЯЦия╕П ржкрзНрж░рж┐ржирзНржЯ PDF</button>
     <button onclick="exportToExcel()">ЁЯУе ржПржХрзНрж╕рзЗрж▓ ржбрж╛ржЙржирж▓рзЛржб</button>
    </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  
  <script>
    const firebaseConfig = { 
	  apiKey: "AIzaSyDwKp_6znRl7TkIpXa3uFuZGOUxSHnkHOM",
      authDomain: "dailyreport-9512d.firebaseapp.com",
      databaseURL: "https://dailyreport-9512d-default-rtdb.firebaseio.com",
      projectId: "dailyreport-9512d",
      storageBucket: "dailyreport-9512d.appspot.com",
      messagingSenderId: "469725849063",
      appId: "1:469725849063:web:3d82a4560478d1b11f8942" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tableBody = document.querySelector('#reportTable tbody');
    const finalTbody = document.querySelector('#finalTable tbody');

    const scoreMap = { 
	  dayFeeling: {"ЁЯШГ ржЦрзБржм ржнрж╛рж▓рзЛ": 1, "ЁЯЩВ ржорзЛржЯрж╛ржорзБржЯрж┐": 0.5, "ЁЯШР ржЦрж╛рж░рж╛ржк": 0},
      learned: {"ЁЯУШ ржирждрзБржи ржжрзЛрзЯрж╛/ржоржирзНрждрзНрж░": 1, "ЁЯУЧ ржХрзЛрж░ржЖржирзЗрж░ ржЖрзЯрж╛ржд/ржЧрзАрждрж╛рж░ рж╢рзНрж▓рзЛржХ": 1, "ЁЯУЩ ржЧржгрж┐ржд/ржмрж┐ржЬрзНржЮрж╛ржи/ржХржорзНржкрж┐ржЙржЯрж╛рж░": 0.7, "ЁЯУЩ ржирждрзБржи рж╢ржмрзНржжрж╛рж░рзНрже (ржЖрж░ржмрзА/ржЗржВрж░рзЗржЬрж┐)": 0.7, "ЁЯУХ ржЗрж╕рж▓рж╛ржорж┐ржХ ржЖржжржм/ржзрж░рзНржорзАрзЯ ржЖржжржм": 1, "ЁЯд╖ ржХрж┐ржЫрзБ рж╢рж┐ржЦрж┐ржирж┐": 0},
      goodDeed: {"ЁЯХМ ржХрж╛ржЙржХрзЗ ржнрж╛рж▓рзЛ ржХрж┐ржЫрзБ рж╢рж┐ржЦрж┐рзЯрзЗржЫрж┐": 1, "ЁЯСР рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗржЫрж┐": 1, "ЁЯШК ржнрж╛рж▓рзЛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрж┐": 0.7, "ЁЯСР ржХрж╛ржЙржХрзЗ ржХрзНрж╖ржорж╛ ржХрж░рзЗ ржжрж┐рзЯрзЗржЫрж┐": 0.7, "ЁЯШЗ ржорж┐ржерзНржпрж╛ ржмрж▓рж┐ржирж┐": 0.7, "ЁЯЩБ ржХрж┐ржЫрзБ ржХрж░рж┐ржирж┐": 0},
      mistake: {"тЬЕ ржХрзЛржирзЛ ржнрзБрж▓ ржХрж░рж┐ржирж┐": 1, "тЬЕ ржнрзБрж▓рзЗрж░ ржЬржирзНржп ржХрзНрж╖ржорж╛ ржЪрзЗрзЯрзЗржЫрж┐": 0.5, "ЁЯЩК ржорж┐ржерзНржпрж╛ ржмрж▓рзЗржЫрж┐": 0, "ЁЯШб рж░рж╛ржЧ ржХрж░рзЗржЫрж┐": 0.3, "ЁЯУЪ ржХрзНрж▓рж╛рж╕/ржкрзНрж░рж╛ржЗржнрзЗржЯрзЗрж░ ржкрзЬрж╛ ржнрж╛рж▓рзЛ рж╣рзЯржирж┐": 0.3, "ЁЯУ▒ ржорзЛржмрж╛ржЗрж▓ ржмрзЗрж╢рж┐ ржжрзЗржЦрзЗржЫрж┐": 0.2},
      lovedPerson: {"ЁЯСй ржорж╛": 1, "ЁЯСи ржмрж╛ржмрж╛": 1, "ЁЯСитАНЁЯПл рж╢рж┐ржХрзНрж╖ржХ": 0.75, "ЁЯСз ржмржирзНржзрзБ": 0.5, "ЁЯдР ржХрзЗржЙ ржирж╛": 0},
      thoughtAbout: {"ЁЯХЛ ржЖрж▓рзНрж▓рж╛рж╣/рж╕рзНрж░рж╖рзНржЯрж╛": 1, "ЁЯУЦ ржкрзЬрж╛рж▓рзЗржЦрж╛": 0.8, "тЪ╜ ржЦрзЗрж▓рж╛ржзрзБрж▓рж╛": 0.4, "ЁЯСР ржкрж░рж┐ржмрж╛рж░/ржЕрж░рзНржержирзАрждрж┐": 0.6, "ЁЯСР рж╕ржорж╛ржЬ/ржжрзЗрж╢": 0.6, "ЁЯЩВ ржХрж┐ржЫрзБ ржирж╛": 0},
      prayerTimes: {"ЁЯХЛ рзл ржмрж╛рж░": 1, "ЁЯХМ рзй-рзк ржмрж╛рж░": 0.6, "ЁЯШХ рзз-рзи ржмрж╛рж░": 0.3, "ЁЯЩБ рзз ржмрж╛рж░ржУ ржирж╛": 0},
      P H M: {"ЁЯФЯ рззрзжрзж%": 1, "тЮР рзпрзж%": 0.7, "тЮМ рзорзж%": 0.3, "ЁЯЩБ рзж%": 0}   
	};

    function calculateStars(item) {
      let total = 0;
      for (let key in scoreMap) {
        total += scoreMap[key][item[key]] || 0;
      }
      return Math.round((total / 8) * 5);
    }
    function renderStars(n) {
      return "тнР".repeat(n) + "тШЖ".repeat(5 - n);
    }

    function refreshList() {
      const fDate = document.getElementById("dateFilter").value;
      const fName = document.getElementById("nameFilter").value.trim();
      const fClass = document.getElementById("classFilter").value;

      db.ref('dailyReports').once('value').then(snap => {
        tableBody.innerHTML = "";
        const data = snap.val();

        if (data) {
          Object.entries(data).forEach(([id, item]) => {
            const d = new Date(item.timestamp).toISOString().split("T")[0];
            if (
              (fDate && fDate !== d) ||
              (fName && !item.studentName.includes(fName)) ||
              (fClass && item.studentClass !== fClass)
            ) return;

            const stars = calculateStars(item);
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${d}</td>
              <td>${item.studentName}</td>
              <td>${item.studentClass}</td>
              <td>${item.studentRoll}</td>
              <td>${renderStars(stars)}</td>
              <td>${item.dayFeeling}</td>
              <td>${item.learned}</td>
              <td>${item.goodDeed}</td>
              <td>${item.mistake}</td>
              <td>${item.lovedPerson}</td>
              <td>${item.thoughtAbout}</td>
              <td>${item.prayerTimes}</td>
              <td>${item.P H M}</td>
              <td>
                <button class="edit-btn" onclick="window.location.href='edit.html?id=${id}'">тЬПя╕П</button>
                <button class="delete-btn" onclick="deleteReport('${id}')">ЁЯЧСя╕П</button>
              </td>
            `;
            tableBody.appendChild(tr);
          });
        }
      });
    }

    function clearFilters() {
      document.getElementById("dateFilter").value = "";
      document.getElementById("nameFilter").value = "";
      document.getElementById("classFilter").value = "";
      refreshList();
    }

    function generateFinalReport() {
      const fDate = document.getElementById("dateFilter").value;
      const fName = document.getElementById("nameFilter").value.trim();
      const fClass = document.getElementById("classFilter").value;

      db.ref('dailyReports').once('value').then(snap => {
        finalTbody.innerHTML = "";
        const data = snap.val();

        if (data) {
          Object.values(data).forEach(item => {
            const d = new Date(item.timestamp).toISOString().split("T")[0];
            if (
              (fDate && fDate !== d) ||
              (fName && !item.studentName.includes(fName)) ||
              (fClass && item.studentClass !== fClass)
            ) return;

            let score = 0;
            for (let key in scoreMap) {
              score += scoreMap[key][item[key]] || 0;
            }
            const stars = Math.round((score / 8) * 5);
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${item.studentName}</td>
              <td>${item.studentClass}</td>
              <td>${item.studentRoll}</td>
              <td>${score.toFixed(2)}</td>
              <td>${renderStars(stars)}</td>
            `;
            finalTbody.appendChild(tr);
          });
        }
        document.getElementById("finalReport").style.display = "block";
      });
    }

    function deleteReport(id) {
      if (confirm("ржЖржкржирж┐ ржХрж┐ рж░рж┐ржкрзЛрж░рзНржЯржЯрж┐ ржорзБржЫрзЗ ржлрзЗрж▓рждрзЗ ржЪрж╛ржи?")) {
        db.ref('dailyReports/' + id).remove();
        refreshList();
      }
    }

    refreshList();
  </script>
  
  <script>
  function printFinalReport() {
    // ржХрзЗржмрж▓ ржЪрзВрзЬрж╛ржирзНржд рж░рж┐ржкрзЛрж░рзНржЯ ржкрзНрж░рж┐ржирзНржЯ рж╣ржмрзЗ
    const printContent = document.getElementById("finalReport").innerHTML;
    const win = window.open('', '', 'width=900,height=700');
    win.document.write(`
      <html>
      <head>
        <title>Final Report</title>
        <style>
          body { font-family: Siyam Rupali, sans-serif; padding:20px; }
          table { width: 100%; border-collapse: collapse; }
          th, td { border: 1px solid #aaa; padding: 6px; text-align: center; }
          th { background: #007f5f; color: white; }
          tr:nth-child(even) { background: #f2f2f2; }
        </style>
      </head>
      <body>${printContent}</body></html>
    `);
    win.document.close();
    win.focus();
    win.print();
    win.close();
  }

  function exportToExcel() {
    let table = document.getElementById("finalTable");
    let html = table.outerHTML.replace(/ /g, '%20');
    const link = document.createElement('a');
    link.href = 'data:application/vnd.ms-excel,' + html;
    link.download = 'FinalReport.xls';
    link.click();
  }
</script>

<script>
  function verifyPassword() {
    const correctPassword = "19895"; // ржЖржкржирж╛рж░ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржПржЦрж╛ржирзЗ ржжрж┐ржи
    const userInput = document.getElementById("pagePassword").value;

    if (userInput === correctPassword) {
      document.getElementById("passwordPrompt").style.display = "none";
      document.getElementById("mainContent").style.display = "block";
    } else {
      document.getElementById("errorText").textContent = "тЫФ ржнрзБрж▓ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб! ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ рж╕ржарж┐ржХ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржжрж┐ржиред";
    }
  }

  // ржмрзНрж░рж╛ржЙржЬрж╛рж░ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржмржирзНржз ржерж╛ржХрж▓рзЗ ржкрзЗржЗржЬ рж▓рзБржХрж╛ржирзЛ ржерж╛ржХржмрзЗ
  document.getElementById("mainContent").style.display = "none";
</script>

</body>
</html>