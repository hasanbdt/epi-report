<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</title> 
  <style>
    body {
      font-family: 'Siyam Rupali', sans-serif;
      background: #fffdee;
      padding-left:60px;
      padding-right:60px;
      max-width: 98%;
      margin: auto;
    }
    h2, h3 {
      text-align: center;
      color: #333;
    }
    .filter-area {
      text-align: center;
      margin: 20px 0;
    }
    .filter-area input, .filter-area select {
      padding: 5px 10px;
      margin: 5px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 6px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background-color: #007f5f;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f7f7f7;
    }
    .print-buttons {
      text-align: center;
      margin-top: 20px;
    }
    button {
      padding: 6px 12px;
      font-size: 14px;
      margin: 0 5px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }
    .print-btn { background: #28a745; color: white; }
    .excel-btn { background: #007bff; color: white; }
    @media print {
      .filter-area, .print-buttons, .nav-links, #topScorersBox, marquee { display: none !important; }
      th { background-color: #007f5f !important; color: white !important; }
    }

    .institute-header {
      text-align: center;
      margin-bottom: 10px;
      margin-top: 10px;
      font-family: 'Siyam Rupali', sans-serif;
    }

    .institute-header .logo {
      width: 100px;
      height: auto;
      vertical-align: middle;
      margin-bottom: 0px;
    }

    .institute-header h1 {
      color: #007f5f;
      margin: 5px 0 2px 0;
      font-size: 24px;
    }

    .institute-header h3 {
      color: #555;
      margin: 2px 0 10px 0;
      font-size: 16px;
      font-weight: normal;
    }
  </style>
</head>
<body>

<!-- Base URL for relative links -->
<base href="https://hasanbdt.github.io/epi-report/">

<!-- ‚úÖ Navigation Menu Start -->
<style>
  .nav-links {
    background-color: #007f5f;
    padding: 10px 0;
    text-align: center;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .nav-links a {
    color: white;
    text-decoration: none;
    margin: 0 15px;
    font-size: 16px;
    font-weight: bold;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background-color 0.3s ease;
  }

  .nav-links a:hover {
    background-color: #34a0a4;
  }
</style>

<div class="nav-links">
  <a href="https://hasanbdt.github.io/epi-report/index.html">üì• ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ</a>
  <a href="https://hasanbdt.github.io/epi-report/list.html">üìã ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶Æ‡ßç‡¶Æ‡¶ø‡¶≤‡¶ø‡¶§</a>
  <a href="https://hasanbdt.github.io/epi-report/list-final.html">‚≠ê ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§</a>
  <a href="https://hasanbdt.github.io/epi-report/edit.html">‚≠ê ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</a>
  <a href="https://hasanbdt.github.io/epi-report/admin.html">‚≠ê ‡¶è‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</a>
</div>

<!-- ‚úÖ Navigation Menu End -->

  <div class="institute-header">
    <img src="epi.png" alt="Logo" class="logo" />
    <h1>‡¶á‡¶™‡¶ø‡¶Ü‡¶á ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø, ‡¶¢‡¶æ‡¶ï‡¶æ</h1>
    <h3>‡¶∏‡ßç‡¶¨‡¶™‡ßç‡¶® ‡¶™‡ßÇ‡¶∞‡¶£‡ßá ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶∞ ‡¶™‡¶•‡ßá...</h3>
  </div>

  <h3>üìã ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</h3> 
  
	<marquee direction="left" scrollamount="5" style="color: green; font-weight: ; font-size: 20px; margin-bottom: 10px;">
		** 5 ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§‡¶¶‡ßá‡¶∞‡¶ï‡ßá ‡¶Ü‡¶®‡ßç‡¶§‡¶∞‡¶ø‡¶ï ‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®--- ‡¶á‡¶™‡¶ø‡¶Ü‡¶á ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶ï **
	</marquee>

  <div class="filter-area">
    <input type="date" id="filterDate">
    <input type="text" id="filterName" placeholder="‡¶®‡¶æ‡¶Æ">
    <select id="filterClass">
      <option value="">‡¶∏‡¶¨ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
      <option value="One">One</option>
      <option value="Two">Two</option>
      <option value="Three">Three</option>
      <option value="Four">Four</option>
      <option value="Five">Five</option>
      <option value="Six">Six</option>
      <option value="Seven">Seven</option>
      <option value="Eight">Eight</option>
	  <option value="Eight">Eight</option>
	  <option value="Eight">Nine</option>
	  <option value="Eight">Ten</option> 
    </select>
    <button onclick="filterData()">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <button onclick="showAll()">‡¶∏‡¶¨ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®</button>
  </div>

	<!-- üî• ‡¶ü‡¶™ ‡ß´ ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶π‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ -->
	<div id="topScorersBox" style="position: absolute; right: 63px; top: 60px; width: 320px; background: #fffdeeb4e6; padding: 3px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.2); font-family: 'Siyam Rupali';">
	  <h4 style="text-align:center; color:#007f5f; margin-bottom: 0px;">‚≠êÔ∏è Top of List (5)</h4>
	  <ol id="topScorersList" style="padding-left: 37px; color: green; font-size: 14px; line-height: 1.8;"></ol>
	</div>



	<table id="finalTable">
	<thead>
	  <tr>
		<th>‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï</th>
		<th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
		<th>‡¶∏‡¶Æ‡ßü</th>
		<th>‡¶®‡¶æ‡¶Æ</th>
		<th>‡¶ï‡ßç‡¶≤‡¶æ‡¶∏</th>
		<th>‡¶∞‡ßã‡¶≤</th>
		<th>‡¶Æ‡ßã‡¶ü ‡¶¶‡¶ø‡¶®</th> <!-- ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® -->
		<th>‡¶∏‡ßç‡¶ï‡ßã‡¶∞</th>
		<th>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞</th>
		<th>‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</th>
	  </tr>
	</thead>


    <tbody></tbody>
  </table>

  <p style= "font-size:15px; color: red; text-align: center;">‡¶¶‡ßÅ‡¶∞‡ßç‡¶≠‡¶æ‡¶ó‡ßç‡¶Ø ‡¶§‡¶æ‡¶∞; ‡¶Ø‡¶æ‡¶∞ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®‡¶ü‡¶ø ‡¶ó‡¶§‡¶ï‡¶æ‡¶≤‡ßá‡¶∞ ‡¶ö‡ßá‡ßü‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶Æ ‡¶π‡¶≤‡ßã ‡¶®‡¶æ‡•§</p>

  <div class="print-buttons">
    <button class="print-btn" onclick="window.print()">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü PDF</button>
    <button class="excel-btn" onclick="exportToExcel()">üì• ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwKp_6znRl7TkIpXa3uFuZGOUxSHnkHOM",
      authDomain: "dailyreport-9512d.firebaseapp.com",
      databaseURL: "https://dailyreport-9512d-default-rtdb.firebaseio.com",
      projectId: "dailyreport-9512d",
      storageBucket: "dailyreport-9512d.appspot.com",
      messagingSenderId: "469725849063",
      appId: "1:469725849063:web:3d82a4560478d1b11f8942"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const scoreMap = {
      dayFeeling: {"üòÉ ‡¶ñ‡ßÅ‡¶¨ ‡¶≠‡¶æ‡¶≤‡ßã": 1, "üôÇ ‡¶Æ‡ßã‡¶ü‡¶æ‡¶Æ‡ßÅ‡¶ü‡¶ø": 0.5, "üòê ‡¶ñ‡¶æ‡¶∞‡¶æ‡¶™": 0},
      learned: {"üìò ‡¶®‡¶§‡ßÅ‡¶® ‡¶¶‡ßã‡ßü‡¶æ/‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞": 1, "üìó ‡¶ï‡ßã‡¶∞‡¶Ü‡¶®‡ßá‡¶∞ ‡¶Ü‡ßü‡¶æ‡¶§/‡¶ó‡ßÄ‡¶§‡¶æ‡¶∞ ‡¶∂‡ßç‡¶≤‡ßã‡¶ï": 1, "üìô ‡¶ó‡¶£‡¶ø‡¶§/‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®/‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞": 0.7, "üìô ‡¶®‡¶§‡ßÅ‡¶® ‡¶∂‡¶¨‡ßç‡¶¶‡¶æ‡¶∞‡ßç‡¶• (‡¶Ü‡¶∞‡¶¨‡ßÄ/‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø)": 0.7, "üìï ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶Ü‡¶¶‡¶¨/‡¶ß‡¶∞‡ßç‡¶Æ‡ßÄ‡ßü ‡¶Ü‡¶¶‡¶¨": 1, "ü§∑ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∂‡¶ø‡¶ñ‡¶ø‡¶®‡¶ø": 0},
      goodDeed: {"üïå ‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶≠‡¶æ‡¶≤‡ßã ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∂‡¶ø‡¶ñ‡¶ø‡ßü‡ßá‡¶õ‡¶ø": 1, "üëê ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø": 1, "üòä ‡¶≠‡¶æ‡¶≤‡ßã ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø": 0.7, "üëê ‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø": 0.7, "üòá ‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ ‡¶¨‡¶≤‡¶ø‡¶®‡¶ø": 0.7, "üôÅ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ï‡¶∞‡¶ø‡¶®‡¶ø": 0},
      mistake: {"‚úÖ ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡ßÅ‡¶≤ ‡¶ï‡¶∞‡¶ø‡¶®‡¶ø": 1, "‚úÖ ‡¶≠‡ßÅ‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ ‡¶ö‡ßá‡ßü‡ßá‡¶õ‡¶ø": 0.5, "üôä ‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ ‡¶¨‡¶≤‡ßá‡¶õ‡¶ø": 0, "üò° ‡¶∞‡¶æ‡¶ó ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø": 0.3, "üìö ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏/‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶ü‡ßá‡¶∞ ‡¶™‡ßú‡¶æ ‡¶≠‡¶æ‡¶≤‡ßã ‡¶π‡ßü‡¶®‡¶ø": 0.3, "üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¶‡ßá‡¶ñ‡ßá‡¶õ‡¶ø": 0.2},
      lovedPerson: {"üë© ‡¶Æ‡¶æ": 1, "üë® ‡¶¨‡¶æ‡¶¨‡¶æ": 1, "üë®‚Äçüè´ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï": 0.75, "üëß ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ": 0.5, "ü§ê ‡¶ï‡ßá‡¶â ‡¶®‡¶æ": 0},
      thoughtAbout: {"üïã ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π/‡¶∏‡ßç‡¶∞‡¶∑‡ßç‡¶ü‡¶æ": 1, "üìñ ‡¶™‡ßú‡¶æ‡¶≤‡ßá‡¶ñ‡¶æ": 0.8, "‚öΩ ‡¶ñ‡ßá‡¶≤‡¶æ‡¶ß‡ßÅ‡¶≤‡¶æ": 0.4, "üëê ‡¶™‡¶∞‡¶ø‡¶¨‡¶æ‡¶∞/‡¶Ö‡¶∞‡ßç‡¶•‡¶®‡ßÄ‡¶§‡¶ø": 0.6, "üëê ‡¶∏‡¶Æ‡¶æ‡¶ú/‡¶¶‡ßá‡¶∂": 0.6, "üôÇ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶æ": 0},
      prayerTimes: {"üïã ‡ß´ ‡¶¨‡¶æ‡¶∞": 1, "üïå ‡ß©-‡ß™ ‡¶¨‡¶æ‡¶∞": 0.6, "üòï ‡ßß-‡ß® ‡¶¨‡¶æ‡¶∞": 0.3, "üôÅ ‡ßß ‡¶¨‡¶æ‡¶∞‡¶ì ‡¶®‡¶æ": 0},
      rememberAllah: {"üîü ‡ßß‡ß¶ ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø": 1, "‚ûê ‡ß´-‡ßß‡ß¶ ‡¶¨‡¶æ‡¶∞": 0.7, "‚ûå ‡ßß-‡ß™ ‡¶¨‡¶æ‡¶∞": 0.3, "üôÅ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡¶ì ‡¶®‡¶æ": 0}   
	};

    function calculateStars(item) {
      let total = 0;
      for (let key in scoreMap) {
        let answer = item[key] || '';
        let value = scoreMap[key][answer] || 0;
        total += value;
      }
      return {
        score: total,
        stars: Math.round((total / 8) * 5)
      };
    }

    function renderStars(n) {
      return "‚≠ê".repeat(n) + "‚òÜ".repeat(5 - n);
    }

	function loadData(filter = {}) {
		db.ref("dailyReports").once("value").then(snap => {
		const data = snap.val();
		const tbody = document.querySelector("#finalTable tbody");
		tbody.innerHTML = "";

		if (!data) return;

		const totalScoreMap = {};
		const now = Date.now();
		const keepLatest = {};
		const dateTrackMap = {}; // ‚úÖ ‡¶Æ‡ßã‡¶ü ‡¶¶‡¶ø‡¶® ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
		const daysCountMap = {}; // ‚úÖ ‡¶®‡¶æ‡¶Æ+‡¶ï‡ßç‡¶≤‡¶æ‡¶∏+‡¶∞‡ßã‡¶≤ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ

		// üßÆ ‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ì latest ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
		Object.entries(data).forEach(([key, item]) => {
		  const stdKey = item.studentName + "|" + item.studentClass + "|" + item.studentRoll;
		  const score = calculateStars(item).score;
		  if (!totalScoreMap[stdKey]) totalScoreMap[stdKey] = 0;
		  totalScoreMap[stdKey] += score;

		  // üßπ ‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶°‡¶ø‡¶≤‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø latest timestamp ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π
		  const dateKey = stdKey + "|" + new Date(item.timestamp).toISOString().split("T")[0];
		  if (!keepLatest[dateKey] || item.timestamp > keepLatest[dateKey].timestamp) {
			keepLatest[dateKey] = { key, item };
		  }

		  // ‚úÖ ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶¶‡¶ø‡¶® ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï
		  if (!dateTrackMap[stdKey]) dateTrackMap[stdKey] = new Set();
		  const dateOnly = new Date(item.timestamp).toISOString().split("T")[0];
		  dateTrackMap[stdKey].add(dateOnly);
		});

		// ‚úÖ ‡¶Æ‡ßã‡¶ü ‡¶¶‡¶ø‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨
		for (const stdKey in dateTrackMap) {
		  daysCountMap[stdKey] = dateTrackMap[stdKey].size;
		}

		// üßπ ‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶°‡¶ø‡¶≤‡ßá‡¶ü (‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ü‡¶ó‡ßá‡¶∞)
		Object.entries(data).forEach(([key, item]) => {
		  const stdKey = item.studentName + "|" + item.studentClass + "|" + item.studentRoll;
		  const dateKey = stdKey + "|" + new Date(item.timestamp).toISOString().split("T")[0];

		  if (keepLatest[dateKey].key !== key && now - item.timestamp > 60 * 1000) {
			db.ref("dailyReports/" + key).remove(); // üî¥ ‡¶°‡¶ø‡¶≤‡ßá‡¶ü
		  }
		});

		// ‚úÖ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶ì ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
		let serial = 1;
		Object.values(data).forEach(item => {
		  const dateObj = new Date(item.timestamp);
		  const date = dateObj.toISOString().split("T")[0];
		  const time = dateObj.toLocaleTimeString('bn-BD');

		  const stdKey = item.studentName + "|" + item.studentClass + "|" + item.studentRoll;
		  const { score, stars } = calculateStars(item);
		  const totalScore = totalScoreMap[stdKey] || score;
		  const totalDays = daysCountMap[stdKey] || 1;

		  // üîç ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞
		  if (
			(filter.date && filter.date !== date) ||
			(filter.name && !item.studentName.includes(filter.name)) ||
			(filter.class && item.studentClass !== filter.class)
		  ) return;

		  const tr = document.createElement("tr");
		  tr.innerHTML = `
			<td>${serial++}</td>
			<td>${date}</td>
			<td>${time}</td>
			<td>${item.studentName}</td>
			<td>${item.studentClass}</td>
			<td>${item.studentRoll}</td>
			<td>${totalDays} ‡¶¶‡¶ø‡¶®</td> <!-- ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶≤‡¶æ‡¶Æ -->
			<td>${score.toFixed(2)}</td>
			<td>${totalScore.toFixed(2)}</td>
			<td>${renderStars(stars)}</td>
		  `;
		  tbody.appendChild(tr);
		  
		// ‚úÖ ‡¶ü‡¶™ ‡ß´ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã (‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ)
			const topScorersList = document.getElementById("topScorersList");
			topScorersList.innerHTML = ""; // ‡¶Ü‡¶ó‡ßá‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶ø
			const sortedScorers = Object.entries(totalScoreMap)
			  .sort((a, b) => b[1] - a[1]) // ‡¶¨‡ßú ‡¶•‡ßá‡¶ï‡ßá ‡¶õ‡ßã‡¶ü
			  .slice(0, 5); // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ü‡¶™ 5
			sortedScorers.forEach(([key, score]) => {
			  const [name, cls, roll] = key.split("|");
			  const li = document.createElement("li");
			  li.textContent = `${name} (${cls}, ‡¶∞‡ßã‡¶≤: ${roll}) ‚Äî ‡¶∏‡ßç‡¶ï‡ßã‡¶∞: ${score.toFixed(2)}`;
			  topScorersList.appendChild(li);
			});		
			
		});
	  });
	}
	
		function cleanOldReports() {
		db.ref("dailyReports").once("value").then(snapshot => {
		const data = snapshot.val();
		const latestMap = {};

		if (data) {
		  Object.entries(data).forEach(([key, item]) => {
			const id = `${item.studentName}_${item.studentClass}_${item.studentRoll}`;
			if (!latestMap[id] || item.timestamp > latestMap[id].timestamp) {
			latestMap[id] = { key, timestamp: item.timestamp };
			}
		  });

		  Object.entries(data).forEach(([key, item]) => {
			const id = `${item.studentName}_${item.studentClass}_${item.studentRoll}`;
			const latestKey = latestMap[id].key;
			const oneHourAgo = Date.now() - (60 * 60 * 1000);

			if (key !== latestKey && item.timestamp < oneHourAgo) {
			  db.ref("dailyReports/" + key).remove();
			}
		  });
		}
	  });
	}


    function filterData() {
      const date = document.getElementById("filterDate").value;
      const name = document.getElementById("filterName").value.trim();
      const studentClass = document.getElementById("filterClass").value;
      loadData({ date, name, class: studentClass });
    }

    function showAll() {
      document.getElementById("filterDate").value = "";
      document.getElementById("filterName").value = "";
      document.getElementById("filterClass").value = "";
      loadData();
    }

    function exportToExcel() {
      const table = document.getElementById("finalTable");
      const html = table.outerHTML.replace(/ /g, '%20');
      const link = document.createElement('a');
      link.href = 'data:application/vnd.ms-excel,' + html;
      link.download = 'FinalReport.xls';
      link.click();
    }

    loadData();
  </script>
</body>
</html>
